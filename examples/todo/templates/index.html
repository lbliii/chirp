<html>
<head>
  <title>Todo App</title>
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <script src="https://unpkg.com/htmx.org@2.0.4"></script>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 600px; margin: 2rem auto; }
    .done { text-decoration: line-through; opacity: 0.6; }
    ul { list-style: none; padding: 0; }
    li { padding: 0.5rem 0; display: flex; align-items: center; gap: 0.5rem; }
    input[type="text"] { flex: 1; padding: 0.5rem; }
    button { padding: 0.25rem 0.5rem; cursor: pointer; }
    form { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
  </style>
</head>
<body>
<script>
  document.body.addEventListener("htmx:configRequest", function(event) {
    var meta = document.querySelector('meta[name="csrf-token"]');
    if (meta) { event.detail.headers["X-CSRF-Token"] = meta.content; }
  });
</script>
<h1>Todos</h1>
<form hx-post="/todos" hx-target="#todo-list" hx-swap="outerHTML"
      hx-validate="true" hx-disabled-elt="#add-btn" hx-indicator="#adding">
  <input type="text" name="text" placeholder="What needs to be done?" required autofocus>
  <button id="add-btn" type="submit">
    Add <img id="adding" class="htmx-indicator" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Ccircle cx='12' cy='12' r='10' stroke='%23888' stroke-width='3' fill='none' stroke-dasharray='31.4' stroke-linecap='round'%3E%3CanimateTransform attributeName='transform' type='rotate' from='0 12 12' to='360 12 12' dur='0.8s' repeatCount='indefinite'/%3E%3C/circle%3E%3C/svg%3E" alt="" style="width:1em;height:1em;vertical-align:middle;">
  </button>
</form>
{% block todo_list %}
<ul id="todo-list">
  {% if error is defined and error %}
  <li class="error" style="color: #dc2626; font-size: 0.85rem;">{{ error }}</li>
  {% end %}
  {% for todo in todos %}
  <li>
    <span class="{{ 'done' if todo.done else '' }}">{{ todo.text }}</span>
    <button hx-post="/todos/{{ todo.id }}/toggle" hx-target="#todo-list" hx-swap="outerHTML">
      {{ "done" if todo.done else "todo" }}
    </button>
    <button hx-delete="/todos/{{ todo.id }}" hx-target="#todo-list" hx-swap="outerHTML">
      remove
    </button>
  </li>
  {% end %}
</ul>
{% endblock %}
</body>
</html>
