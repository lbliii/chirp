{% extends "base.html" %}

{% block title %}Photo Gallery{% endblock %}

{% block content %}
<h1>Photo Gallery</h1>

{% block upload_form %}
<form method="post" action="/upload" enctype="multipart/form-data">
  {{ csrf_field() }}

  <label for="title">Title</label>
  <input type="text" id="title" name="title"
         value="{{ form.title if form is defined and form else '' }}"
         class="{{ 'error' if errors is defined and errors and 'title' in errors else '' }}"
         placeholder="A name for your photo">
  {% if errors is defined and errors and 'title' in errors %}
    {% for msg in errors['title'] %}
    <p class="field-error">{{ msg }}</p>
    {% endfor %}
  {% endif %}

  <label for="description">Description <span class="hint">(optional)</span></label>
  <textarea id="description" name="description"
            class="{{ 'error' if errors is defined and errors and 'description' in errors else '' }}"
            placeholder="Tell us about this photo">{{ form.description if form is defined and form else '' }}</textarea>
  {% if errors is defined and errors and 'description' in errors %}
    {% for msg in errors['description'] %}
    <p class="field-error">{{ msg }}</p>
    {% endfor %}
  {% endif %}

  <label for="photo">Photo</label>
  <input type="file" id="photo" name="photo" accept="image/jpeg,image/png,image/gif,image/webp">
  {% if errors is defined and errors and 'photo' in errors %}
    {% for msg in errors['photo'] %}
    <p class="field-error">{{ msg }}</p>
    {% endfor %}
  {% endif %}
  <p class="hint">JPEG, PNG, GIF, or WebP. Max 5 MB.</p>

  <button type="submit" style="margin-top: 1rem;">Upload photo</button>
</form>
{% endblock %}

<hr>

{% if photos %}
<div class="grid">
  {% for photo in photos %}
  <a href="/photos/{{ photo.id }}" class="card" style="text-decoration: none; color: inherit;">
    <img src="/uploads/{{ photo.filename }}" alt="{{ photo.title }}">
    <div class="card-body">
      <h3>{{ photo.title }}</h3>
      <p>{{ photo.size | filesize }}</p>
    </div>
  </a>
  {% endfor %}
</div>
{% else %}
<p class="empty">No photos yet. Upload one above!</p>
{% endif %}
{% endblock %}
