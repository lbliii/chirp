# Chirp Examples

Working examples that demonstrate chirp's core capabilities. Each is self-contained
and runnable — start the dev server or run the tests.

## Examples

### `hello/` — The Basics

Routes, return-value content negotiation, path parameters, Response chaining, error handlers.
No templates. Pure Python. Chirp in ~30 lines.

```bash
cd examples/hello && python app.py
```

### `todo/` — htmx Fragments

The killer feature. A todo list where the same template renders as a full page or a fragment,
depending on whether the request came from htmx. Add, toggle, and delete items with partial
page updates — zero client-side JavaScript.

```bash
cd examples/todo && python app.py
```

### `sse/` — Real-Time Events

Server-Sent Events pushing HTML fragments to the browser in real-time. The async generator
yields strings, structured SSEEvent objects, and kida-rendered Fragment objects — demonstrating
all three SSE payload types.

```bash
cd examples/sse && python app.py
```

### `dashboard/` — Full Stack Showcase

The complete Pounce + Chirp + Kida pipeline. A weather station with 6 live sensors:
streaming initial render, fragment caching, SSE-driven updates, and multi-worker
free-threading. Open your browser and watch the data change.

```bash
cd examples/dashboard && python app.py
```

### `hackernews/` — Hacker News Live Reader

A live Hacker News reader consuming the real HN Firebase API. Stories load from the
live API, scores and comment counts update in real-time via SSE, and comment trees
render recursively using kida's `{% def %}`. View Transitions animate between the
story list and detail pages. Zero client-side JavaScript beyond htmx.

```bash
pip install httpx  # or pip install chirp[all]
cd examples/hackernews && python app.py
```

### `rag_demo/` — RAG with Streaming AI Answers

A documentation site with AI-powered Q&A. SQLite stores docs, Claude streams answers
with cited sources. Demonstrates per-worker lifecycle hooks — global `on_startup` for
schema migration, `on_worker_startup` / `on_worker_shutdown` for per-worker database
connections via `ContextVar`. Multi-worker Pounce for free-threading.

```bash
pip install chirp[ai,data]
export ANTHROPIC_API_KEY="sk-..."
cd examples/rag_demo && python app.py
```

## Patterns

Lessons from building these examples — things that aren't bugs but require
intentional decisions from the developer.

### Mark third-party HTML with `| safe`

Kida auto-escapes all template output by default. This is correct — it prevents
XSS. But when you're rendering pre-formatted HTML from an external source (API
responses, CMS content, markdown output), you need to explicitly opt out:

```html
{# Bad: <p> tags rendered as literal &lt;p&gt; text #}
<div class="comment-text">{{ comment.text }}</div>

{# Good: HTML rendered as intended #}
<div class="comment-text">{{ comment.text | safe }}</div>
```

The `| safe` filter accepts an optional `reason=` parameter for documenting why
the content is trusted:

```html
{{ api_html | safe(reason="sanitized by HN API") }}
{{ rendered_md | safe(reason="generated by markdown parser") }}
```

Auto-escaping is a guardrail, not a sharp edge. The `| safe` call is your
declaration that you've thought about trust.

### Use a unique ID for your htmx swap target

When chirp swaps fragments into the page, the `hx-target` selector must resolve
to exactly one element. A class like `.container` is a layout utility that may
appear in headers, footers, and sidebars. Use a unique ID instead:

```html
{# Bad: ambiguous — multiple .container elements on the page #}
<a hx-get="/story/1" hx-target=".container">...</a>

{# Good: one unambiguous target #}
<div id="main" class="container">...</div>
<a hx-get="/story/1" hx-target="#main">...</a>
```

This also matters for View Transitions — `view-transition-name` must be unique
per page. Applying it to a class that matches multiple elements triggers a
browser warning and breaks the transition animation.

```css
/* Bad: every .container gets the same transition name */
.container { view-transition-name: page-content; }

/* Good: only the content area transitions */
#main { view-transition-name: page-content; }
```

ID-based targeting is faster for the browser, unambiguous for htmx, and
compatible with the CSS view-transition-name uniqueness requirement.

## Running Tests

Each example has a `test_app.py` that verifies it works through the ASGI pipeline
using chirp's `TestClient`. No HTTP server required.

```bash
# All examples
pytest examples/

# One example
pytest examples/hello/
```

## What Each Example Exercises

| Feature | hello | todo | sse | dashboard | hackernews | rag_demo |
|---|:---:|:---:|:---:|:---:|:---:|:---:|
| `@app.route()` | x | x | x | x | x | x |
| Path parameters | x | x | | | x | |
| String returns | x | | | | | |
| Dict/JSON returns | x | | | | | |
| `Response` chaining | x | | | | | |
| `@app.error()` | x | | | | | |
| `Template` | | x | x | | x | x |
| `Fragment` | | x | x | x | x | x |
| `Stream` | | | | x | | |
| `request.is_fragment` | | x | | | x | |
| `@app.template_filter()` | | x | | x | x | |
| `EventStream` | | | x | x | x | x |
| `SSEEvent` | | | x | | | |
| `{% cache %}` | | | | x | x | |
| `hx-swap-oob` | | | | x | x | |
| Multi-worker Pounce | | | | x | x | x |
| `TestClient.fragment()` | | x | | | x | |
| `TestClient.sse()` | | | x | x | x | |
| `@app.on_startup` | | | | | x | x |
| `@app.on_worker_startup` | | | | | x | x |
| `@app.on_worker_shutdown` | | | | | x | x |
| `httpx` (real API) | | | | | x | |
| `chirp.data` (SQLite) | | | | | | x |
| `chirp.ai` (LLM streaming) | | | | | | x |
| `ContextVar` per-worker | | | | | x | x |
| Recursive `{% def %}` | | | | | x | |
| View Transitions | | | | | x | |
